<!-- menu.html -->
<nav class="navbar">
  <div class="navbar-logo">VotoUni</div>

  <div class="navbar-search">
    <input type="text" placeholder="Buscar..." id="searchInput" data-i18n-placeholder="searchPlaceholder" />
    <button class="search-btn" id="btnBuscar">🔍</button>
  </div>

  <ul class="navbar-links" id="navLinks">
    <li><a href="inicio2.html" data-i18n="navHome">Inicio</a></li>
    <li><a href="candidatos.html" data-i18n="navCandidates">Candidatos</a></li>
    <li><a href="votacion.html" data-i18n="navVote">Votar</a></li>
    <li><a href="resultados.html" data-i18n="navResults">Resultados</a></li>
    <li><a href="reseñas.html" data-i18n="navReviews">Reseñas</a></li>
    <li><a href="contacto.html" data-i18n="navContact">Contacto</a></li>
    <li><a href="inicio.html" data-i18n="navLogout" id="cerrarSesionUsuario">Cerrar Sesión</a></li>
  </ul>

  <!-- ⬇️ SELECTOR DE IDIOMA MEJORADO -->
  <select id="langSelect" class="lang-select">
    <option value="es">🇪🇸 ES</option>
    <option value="en">🇺🇸 EN</option>
    <option value="id">🇮🇩 ID</option>
  </select>

  <div class="navbar-toggle" id="toggleMenuBtn">☰</div>
</nav>

<script>
/* ————————————————————————————  SISTEMA DE TRADUCCIONES  ———————————————————————————— */
const translations = {
  es: {
    // Navegación
    navHome: "Inicio",
    navCandidates: "Candidatos", 
    navVote: "Votar",
    navResults: "Resultados",
    navReviews: "Reseñas",
    navContact: "Contacto",
    navLogout: "Cerrar Sesión",
    searchPlaceholder: "Buscar...",
    
    // Búsqueda
    searchEmpty: "Escribe algo para buscar",
    searchNoResults: "No se encontraron resultados para:",
    searchResultsFor: "Resultados de búsqueda para:",
    
    // Páginas comunes
    loading: "Cargando...",
    error: "Error",
    success: "Éxito"
  },
  en: {
    // Navigation
    navHome: "Home",
    navCandidates: "Candidates",
    navVote: "Vote", 
    navResults: "Results",
    navReviews: "Reviews",
    navContact: "Contact",
    navLogout: "Logout",
    searchPlaceholder: "Search...",
    
    // Search
    searchEmpty: "Type something to search",
    searchNoResults: "No results found for:",
    searchResultsFor: "Search results for:",
    
    // Common pages
    loading: "Loading...",
    error: "Error",
    success: "Success"
  },
  id: {
    // Navigasi
    navHome: "Beranda",
    navCandidates: "Kandidat",
    navVote: "Pilih",
    navResults: "Hasil",
    navReviews: "Ulasan", 
    navContact: "Kontak",
    navLogout: "Keluar",
    searchPlaceholder: "Cari...",
    
    // Pencarian
    searchEmpty: "Ketik sesuatu untuk mencari",
    searchNoResults: "Tidak ada hasil untuk:",
    searchResultsFor: "Hasil pencarian untuk:",
    
    // Halaman umum
    loading: "Memuat...",
    error: "Kesalahan",
    success: "Berhasil"
  }
};

/* ————————————————————————————  IDIOMA ACTUAL  ———————————————————————————— */
let currentLang = localStorage.getItem("lang") || "es";

/* ————————————————————————————  APLICAR TRADUCCIÓN  ———————————————————————————— */
function applyTranslations() {
  console.log("🌐 Aplicando traducción:", currentLang);
  
  // Traducir elementos con data-i18n
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    if (translations[currentLang] && translations[currentLang][key]) {
      el.textContent = translations[currentLang][key];
    }
  });
  
  // Traducir placeholders
  document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
    const key = el.getAttribute("data-i18n-placeholder");
    if (translations[currentLang] && translations[currentLang][key]) {
      el.placeholder = translations[currentLang][key];
    }
  });
}

/* ————————————————————————————  MENÚ RESPONSIVE  ———————————————————————————— */
function initMenuToggle() {
  const toggleBtn = document.getElementById("toggleMenuBtn");
  const navLinks = document.getElementById("navLinks");
  
  if (toggleBtn && navLinks) {
    toggleBtn.addEventListener("click", () => {
      navLinks.classList.toggle("active");
    });
    console.log("✅ Menú responsive conectado");
  }
}

/* ————————————————————————————  SISTEMA DE BÚSQUEDA MEJORADO  ———————————————————————————— */
function performSearch() {
  const searchInput = document.getElementById("searchInput");
  
  if (!searchInput) {
    console.error("❌ No se encontró el campo de búsqueda");
    alert("Error: Campo de búsqueda no encontrado");
    return;
  }
  
  const query = searchInput.value.toLowerCase().trim();
  console.log("🔍 Valor de búsqueda:", query);
  
  if (!query) {
    alert(translations[currentLang].searchEmpty);
    return;
  }
  
  console.log("🔍 Buscando:", query);
  
  // Términos de búsqueda multiidioma
  const searchTerms = {
    candidates: {
      es: ["candidato", "candidatos", "presidente", "vicepresidente", "lista", "listas", "ana", "luis", "camila", "roberto"],
      en: ["candidate", "candidates", "president", "vice president", "list", "lists", "ana", "luis", "camila", "roberto"],
      id: ["kandidat", "presiden", "wakil presiden", "daftar", "ana", "luis", "camila", "roberto"]
    },
    vote: {
      es: ["votar", "votación", "voto", "votos", "elegir", "elección", "sufragio"],
      en: ["vote", "voting", "election", "choose", "ballot", "poll"],
      id: ["pilih", "pemilihan", "suara", "memilih", "voting"]
    },
    results: {
      es: ["resultado", "resultados", "ganador", "conteo", "estadística", "estadisticas"],
      en: ["result", "results", "winner", "count", "statistics", "stats"],
      id: ["hasil", "pemenang", "perhitungan", "statistik"]
    },
    home: {
      es: ["inicio", "principal", "casa", "hogar", "bienvenida", "bienvenido"],
      en: ["home", "main", "start", "beginning", "welcome"],
      id: ["beranda", "utama", "awal", "selamat datang"]
    },
    reviews: {
      es: ["reseña", "reseñas", "opinión", "opiniones", "experiencia", "comentario", "valoración"],
      en: ["review", "reviews", "opinion", "opinions", "experience", "comment", "rating"],
      id: ["ulasan", "pendapat", "pengalaman", "komentar", "penilaian"]
    },
    contact: {
      es: ["contacto", "contactar", "mensaje", "comunicar", "ayuda", "soporte"],
      en: ["contact", "message", "communicate", "reach", "help", "support"],
      id: ["kontak", "pesan", "berkomunikasi", "bantuan", "dukungan"]
    }
  };
  
  // Buscar coincidencias
  let destination = null;
  let matchedTerm = "";
  
  for (const [page, terms] of Object.entries(searchTerms)) {
    const allTerms = Object.values(terms).flat();
    const matchedTermFound = allTerms.find(term => query.includes(term));
    
    if (matchedTermFound) {
      matchedTerm = matchedTermFound;
      switch (page) {
        case 'candidates': destination = 'candidatos.html'; break;
        case 'vote': destination = 'votacion.html'; break;
        case 'results': destination = 'resultados.html'; break;
        case 'home': destination = 'inicio2.html'; break;
        case 'reviews': destination = 'reseñas.html'; break;
        case 'contact': destination = 'contacto.html'; break;
      }
      break;
    }
  }
  
  console.log("🎯 Término encontrado:", matchedTerm);
  console.log("📍 Destino:", destination);
  
  if (destination) {
    console.log("✅ Redirigiendo a:", destination);
    // Mostrar mensaje antes de redirigir
    searchInput.value = "";  // Limpiar campo
    alert(`Redirigiendo a: ${matchedTerm} → ${destination}`);
    setTimeout(() => {
      window.location.href = destination;
    }, 1000);
  } else {
    alert(`${translations[currentLang].searchNoResults} "${query}"`);
    console.log("❌ No se encontraron coincidencias para:", query);
  }
}

// Eventos de búsqueda - Con verificación de elementos
function initSearchEvents() {
  const btnBuscar = document.getElementById("btnBuscar");
  const searchInput = document.getElementById("searchInput");
  
  if (btnBuscar) {
    btnBuscar.addEventListener("click", e => {
      e.preventDefault();
      performSearch();
    });
    console.log("✅ Botón de búsqueda conectado");
  }

  if (searchInput) {
    searchInput.addEventListener("keypress", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        performSearch();
      }
    });
    console.log("✅ Campo de búsqueda conectado");
  }
}

/* ————————————————————————————  SELECTOR DE IDIOMA  ———————————————————————————— */
function initLanguageSelector() {
  const langSelect = document.getElementById("langSelect");
  
  if (langSelect) {
    langSelect.addEventListener("change", e => {
      const newLang = e.target.value;
      console.log("🔄 Cambiando idioma a:", newLang);
      
      localStorage.setItem("lang", newLang);
      currentLang = newLang;
      
      // Aplicar traducción inmediatamente
      applyTranslations();
      
      // Opcional: recargar la página para aplicar todas las traducciones
      setTimeout(() => {
        location.reload();
      }, 500);
    });
    console.log("✅ Selector de idioma conectado");
  }
}

/* ————————————————————————————  CERRAR SESIÓN  ———————————————————————————— */
function initLogout() {
  const logoutBtn = document.getElementById("cerrarSesionUsuario");
  
  if (logoutBtn) {
    logoutBtn.addEventListener("click", e => {
      e.preventDefault();
      localStorage.removeItem("rolUsuario");
      localStorage.removeItem("usuarioActual");
      window.location.href = "inicio.html";
    });
    console.log("✅ Botón cerrar sesión conectado");
  }
}

/* ————————————————————————————  INICIALIZACIÓN  ———————————————————————————— */
document.addEventListener("DOMContentLoaded", () => {
  console.log("🚀 Inicializando menú...");
  
  // Establecer idioma en el selector
  const langSelect = document.getElementById("langSelect");
  if (langSelect) {
    langSelect.value = currentLang;
  }
  
  // Aplicar traducciones
  applyTranslations();
  
  // Inicializar todos los eventos
  initMenuToggle();
  initSearchEvents();
  initLanguageSelector();
  initLogout();
  
  console.log("✅ Menú inicializado con idioma:", currentLang);
});

// Aplicar traducciones inmediatamente
applyTranslations();

// También inicializar eventos inmediatamente por si el DOM ya está listo
setTimeout(() => {
  initMenuToggle();
  initSearchEvents();
  initLanguageSelector(); 
  initLogout();
}, 100);
</script>
